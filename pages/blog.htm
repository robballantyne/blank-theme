title = "Blog"
url = "/blog/:page?"
layout = "2-col-right"
is_hidden = 0

[blogPosts]
pageNumber = "{{ :page }}"
postsPerPage = 10
noPostsMessage = "No posts found"
sortOrder = "published_at desc"
categoryPage = "blog-category"
postPage = "blog-post"
==
<?php
use RainLab\Blog\Models\Post as BlogPost;
use RainLab\Blog\Models\Category as BlogCategory;

protected $blogComponent;

function onLoadMoreBlogPosts() {
    $page = Input::get('page');
    $this->blogComponent = $this->components['blogPosts'];
    $this->blogComponent->posts = $this->listBlogPosts($page);
    return [
        '@#posts-grid' => $this->renderPartial('blogPosts/postloop', [
        'posts' => $this->blogComponent->posts
        ]),
        '#posts-paginator' => $this->renderPartial('blogPosts/pagination', [
        'posts' => $this->blogComponent->posts
        ])
    ];
}

function listBlogPosts($page)
{
    $category = $this->blogComponent->category ? $this->blogComponent->category->id : null;

    $posts = BlogPost::with('categories')->listFrontEnd([
    'page'       => $page,
    'sort'       => $this->blogComponent->property('sortOrder'),
    'perPage'    => $this->blogComponent->property('postsPerPage'),
    'search'     => trim(input('search')),
    'category'   => $category,
    'published'  => true,
    'exceptPost' => $this->blogComponent->property('exceptPost'),
    ]);

    /*
    * Add a "url" helper attribute for linking to each post and category
    */
    $posts->each(function($post) {
    $post->setUrl($this->blogComponent->property('postPage'), $this->controller);

    $post->categories->each(function($category) {
        $category->setUrl($this->blogComponent->property('categoryPage'), $this->controller);
        });
    });

    return $posts;
}
?>
==
<h1>The blog listing</h1>

{% component 'blogPosts' %}